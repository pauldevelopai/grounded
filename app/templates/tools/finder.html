{% extends "base.html" %}

{% block title %}Matcher - {{ product_name }}{% endblock %}

{% block content %}
<div class="px-4 sm:px-0">

    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Matcher</h1>
        <p class="mt-2 text-gray-600 max-w-2xl">
            Tell us what you need to do. We'll match you with the best AI tools based on cost, difficulty and data privacy.
        </p>
    </div>

    <!-- Needs Grid -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">What do you need to do?</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
            {% for key, info in needs.items() %}
            <a href="/tools/finder?need={{ key }}"
               class="block p-4 rounded-lg border-2 transition
                   {% if selected_need == key %}
                   border-blue-500 bg-blue-50
                   {% else %}
                   border-gray-200 hover:border-blue-300 hover:bg-gray-50
                   {% endif %}">
                <div class="font-medium text-sm
                    {% if selected_need == key %}text-blue-900{% else %}text-gray-900{% endif %}">
                    {{ info.label }}
                </div>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Personalized Picks (logged-in users with selected need) -->
    {% include "components/suggested_block.html" %}

    <!-- Results -->
    {% if selected_need and recommended %}
    <div class="mb-4">
        <h2 class="text-xl font-semibold text-gray-900">
            Recommended Tools for: {{ selected_need_info.label }}
        </h2>
        <p class="text-sm text-gray-500 mt-1">
            {{ recommended|length }} tools found. Sorted by overall ease of adoption (lowest combined CDI score first).
        </p>
    </div>

    <div class="space-y-4 mb-8">
        {% for tool in recommended %}
        <div class="bg-white rounded-lg shadow hover:shadow-md transition">
            <div class="p-6">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <a href="/tools/{{ tool.slug }}" class="text-lg font-semibold text-gray-900 hover:text-blue-600">
                                {{ tool.name }}
                            </a>
                            {% if 'sovereign-alternative' in tool.tags %}
                            <span class="px-2 py-0.5 rounded-full text-xs bg-emerald-100 text-emerald-800">Sovereign</span>
                            {% endif %}
                            {% if 'free' in tool.tags %}
                            <span class="px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">Free</span>
                            {% endif %}
                            {% if 'beginner-friendly' in tool.tags %}
                            <span class="px-2 py-0.5 rounded-full text-xs bg-sky-100 text-sky-800">Beginner Friendly</span>
                            {% endif %}
                        </div>

                        <p class="text-sm text-gray-600 mb-3">
                            {% if tool.purpose %}{{ tool.purpose }}{% else %}{{ tool.description[:200] }}{% if tool.description|length > 200 %}...{% endif %}{% endif %}
                        </p>

                        {% if tool.journalism_relevance %}
                        <p class="text-sm text-gray-500 italic mb-3">
                            {{ tool.journalism_relevance[:200] }}{% if tool.journalism_relevance|length > 200 %}...{% endif %}
                        </p>
                        {% endif %}

                        <div class="flex items-center gap-4">
                            <a href="/tools/{{ tool.slug }}" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                View full details &rarr;
                            </a>
                            <a href="/clusters/{{ tool.cluster_slug }}" class="text-xs text-gray-400 hover:text-gray-600">
                                {{ tool.cluster_name }}
                            </a>
                        </div>
                    </div>

                    <!-- CDI Scores -->
                    <div class="flex gap-2 ml-6 flex-shrink-0">
                        <div class="text-center px-3 py-2 rounded-lg
                            {% if tool.cdi_scores.cost <= 3 %}bg-green-50
                            {% elif tool.cdi_scores.cost <= 6 %}bg-yellow-50
                            {% else %}bg-red-50{% endif %}">
                            <div class="text-xs text-gray-500 uppercase">Cost</div>
                            <div class="text-xl font-bold
                                {% if tool.cdi_scores.cost <= 3 %}text-green-700
                                {% elif tool.cdi_scores.cost <= 6 %}text-yellow-700
                                {% else %}text-red-700{% endif %}">
                                {{ tool.cdi_scores.cost }}
                            </div>
                        </div>
                        <div class="text-center px-3 py-2 rounded-lg
                            {% if tool.cdi_scores.difficulty <= 3 %}bg-green-50
                            {% elif tool.cdi_scores.difficulty <= 6 %}bg-yellow-50
                            {% else %}bg-red-50{% endif %}">
                            <div class="text-xs text-gray-500 uppercase">Diff</div>
                            <div class="text-xl font-bold
                                {% if tool.cdi_scores.difficulty <= 3 %}text-green-700
                                {% elif tool.cdi_scores.difficulty <= 6 %}text-yellow-700
                                {% else %}text-red-700{% endif %}">
                                {{ tool.cdi_scores.difficulty }}
                            </div>
                        </div>
                        <div class="text-center px-3 py-2 rounded-lg
                            {% if tool.cdi_scores.invasiveness <= 3 %}bg-green-50
                            {% elif tool.cdi_scores.invasiveness <= 6 %}bg-yellow-50
                            {% else %}bg-red-50{% endif %}">
                            <div class="text-xs text-gray-500 uppercase">Inv</div>
                            <div class="text-xl font-bold
                                {% if tool.cdi_scores.invasiveness <= 3 %}text-green-700
                                {% elif tool.cdi_scores.invasiveness <= 6 %}text-yellow-700
                                {% else %}text-red-700{% endif %}">
                                {{ tool.cdi_scores.invasiveness }}
                            </div>
                        </div>
                    </div>
                </div>

                {% if tool.time_dividend.time_saved %}
                <div class="mt-3 pt-3 border-t border-gray-100">
                    <span class="text-xs font-medium text-green-700 bg-green-50 px-2 py-1 rounded">
                        Time saved: {{ tool.time_dividend.time_saved }}
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    {% elif selected_need and not recommended %}
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <h3 class="text-xl font-semibold text-gray-700 mb-2">No tools found for this need</h3>
        <p class="text-gray-500">Try selecting a different need above.</p>
    </div>
    {% else %}
    <!-- No selection yet - show guidance -->
    <div class="bg-blue-50 rounded-lg border border-blue-200 p-8 text-center">
        <h3 class="text-lg font-semibold text-blue-900 mb-2">Select a task above to get started</h3>
        <p class="text-sm text-blue-700 max-w-lg mx-auto">
            Choose what you need to accomplish, and we'll show you the best AI tools
            ranked by how easy, affordable and privacy-respecting they are.
        </p>
    </div>
    {% endif %}

    <!-- Key for CDI Scores -->
    <div class="mt-8 bg-gray-50 rounded-lg p-6">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">Understanding CDI Scores</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
            <div>
                <span class="font-medium text-gray-900">Cost (0-10)</span>
                <p class="text-gray-500 text-xs mt-1">0 = Free, 10 = Expensive. How much it costs to use regularly.</p>
            </div>
            <div>
                <span class="font-medium text-gray-900">Difficulty (0-10)</span>
                <p class="text-gray-500 text-xs mt-1">0 = No training needed, 10 = Requires technical expertise.</p>
            </div>
            <div>
                <span class="font-medium text-gray-900">Invasiveness (0-10)</span>
                <p class="text-gray-500 text-xs mt-1">0 = Runs locally, no data sent. 10 = All data processed in cloud.</p>
            </div>
        </div>
    </div>

</div>
{% endblock %}
